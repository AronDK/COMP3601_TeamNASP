# AXI4 Protocol

## Intro
When you start working with SoC platforms with FPGAs you will find that communication between the FPGA and the processor will either be using the *AMBA AXI* or *Avalon* bus. These two bus interfaces provide a pathway between the hard core (e.g. ARM Cortex A53) and soft core (FPGA). 

The AMBA AXI protocol is an on-chip communication protocol developed by ARM and is in most Xilinx IPs. With 

---
## Protocol subsets
There are three sub-protocols of the AMBA AXI4 communication protocol, respectively being:
- AXI4-MM
- AXI4-Lite
- AXI4-Stream

---
## General concepts
- Handshake: AXI defines a handshake mechanism which is done through an `xVALID` and `xREADY` signal. The `xVALID` is asserted by the source to inform the receviving entity that the payload data on the *channel* is valid. The `xREADY` signal is asserted by the receiving entity to inform the source that it is ready to receive and handle the data.

- Channel: An independent collection of AXI signals associated with the `VALID` and `READY` signals.
- Transfer: A piece of data transmitted on a single channel. Transfers happen when both the `VALID` and `READY` signal are high while there is a rising edge of the clock.

> Some requirements of `VALID` and `READY`: 
> - When `VALID` is asserted, it must remain asserted until rising clock edge after the slave asserts `READY`
> - The `VALID` signal must not be dependant on the `READY` signal, however, `READY` can be dependant on the `VALID` signal.
> - A write response must always follow the last write transfer in the write transaction of which it is part of.
> - Read data must always follow the address to which the data relates.
> - A slave must wait for both ARVALID and ARREADY to be asserted before it asserts RVALID to indicate that valid data is available

### AXI Read Transaction
A *Read Transaction* requires two transactions over two channels (Read Address Channel* and the *Read Data Channel). The *Read Address Channel* transfers the address of some control signals from Master to Slave and the data will be transferred from the Slave to Master on the *Read data channel*.

![Block design](/docs/dante_kria/images/axi_read_channels.png)

### AXI Write Transaction
A *Write Transaction* requires three transaction over three channels (*Write Address Channel*, *Write Data Channel*, *Write Response Channel*). The *Write Address Channel* will send the address from Master to Slave followed by a transaction of data from Master to Slave. Once the data is sent to the slave, the slave transfers a *write response* back to the master on the *Write Response Channel* to indicate if the write transfer was successful.

Response values:
- OKAY (0b00): Normal access okay.
- EXOKAY (0b01): Exclusive access okay.
- SLVERR (0b10): Slave error. Successfully reached slave but slave has run into an error.
- DECERR (0b11): Decode error. Usually generated by an *interconnect component*, to indicate that there is no slave at the transaction address.

![Block design](/docs/dante_kria/images/axi_write_channels.png)

> Note: If a transaction contains multiple data word chunks transferred it is called a *data burst*.

---

### AXI4-MM (Not used in baseline project)
AXI4-MM is the high-performance memory-mapped sub-protocol of AMBA AXI4. 


### AXI4-Lite
AXI4-Lite is the low-throughput memory-mapped sub-protocol of AMBA AXI4.

AXI4-Lite is a simplified version of the AXI4-MM protocol. With lower-throughput and performance, this protocol is mostly used to provide memory-mapped access to hardware status registers or control registers. 

> Note: You roughly get ~16MB/s throughput

![Block design](/docs/dante_kria/images/axilite.png)


### AXI4-Stream
AXI4-Stream is the high-throughput data streaming sub-protocol of AMBA AXI4.
Signals: (Note: only the required signals are discussed here)
- TVALID (Master to Slave)
- TREADY (Slave to Master)
- TDATA  (Master to Slave)
- TLAST  (Master to Slave)

As usual, the `TVALID` and `TREADY` signals are the handshake signals providing flow control mechanism. When both are asserted on a clock rising edge event the `TDATA` is valid and will be transferred from the Master to Slave component. `TLAST` is used to indicate if the data word on the data channel is the last word of the transaction. 

Throughput of the AXI stream protocol on the Zynq 7020 device gets an average 333MB/s which is significantly higher than that of AXI-Lite. Hence for platforms requiring higher data transfer rates such as video streaming AXI stream is usually used.


![Block design](/docs/dante_kria/images/axistream.png)

---

### Links

- https://en.wikipedia.org/wiki/Advanced_eXtensible_Interface
- https://support.xilinx.com/s/article/1053914?language=en_US
- http://www.gstitt.ece.ufl.edu/courses/fall15/eel4720_5721/labs/refs/AXI4_specification.pdf
- https://zipcpu.com/doc/axi-stream.pdf